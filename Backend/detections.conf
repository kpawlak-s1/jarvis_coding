# SentinelOne AI-SIEM Detection Rules for Operation Digital Heist
# Attack Scenario Detection Configuration
# =====================================

# RECONNAISSANCE PHASE DETECTIONS
# ================================

[R-001: Mass Phishing Campaign Detection]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='Proofpoint' AND threatType='phish' AND sender CONTAINS 'financorp' AND recipient IN ('john.doe@financorp.com','jane.smith@financorp.com','bob.johnson@financorp.com','alice.williams@financorp.com','admin@financorp.com')"
Severity=MEDIUM
Description=Detects targeted phishing campaigns against FinanceCorp employees using domain spoofing

[R-002: Brute Force Authentication Attempts] 
Detection logic conditions
Rule type=Aggregated event
Query="(dataSource.vendor='Microsoft' AND resultType='50126') OR (dataSource.vendor='SentinelOne' AND event.login.loginIsSuccessful=false AND event.category='Authentication')"
Threshold=count > 5 in 5 minutes by userPrincipalName OR event.login.userName
Severity=HIGH
Description=Detects multiple failed login attempts indicating brute force attack

[R-003: External Reconnaissance Activity]
Detection logic conditions  
Rule type=Single event
Query="dataSource.vendor='Darktrace' AND model.name CONTAINS 'Suspicious Domain' AND (externalDomain CONTAINS 'phishing-bank-security.com' OR externalDomain CONTAINS 'secure-financorp-update.net')"
Severity=MEDIUM
Description=Detects connections to suspicious domains used for reconnaissance

[R-004: SentinelOne Network Reconnaissance]
Detection logic conditions
Rule type=Single event  
Query="dataSource.vendor='SentinelOne' AND event.type='Network Connection' AND dst.ip.address IN ('185.220.101.42','94.102.61.13') AND indicator.category='Reconnaissance'"
Severity=MEDIUM
Description=Detects network connections to known attack infrastructure during reconnaissance

# INITIAL ACCESS PHASE DETECTIONS
# ================================

[IA-001: Successful Phishing with Malware Delivery]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='Microsoft' AND ThreatTypes='Malware' AND DeliveryAction='Delivered'"
Severity=CRITICAL
Description=Detects successful malware delivery via email indicating initial access compromise

[IA-002: Malware Execution Detection - CrowdStrike]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='CrowdStrike' AND event_simpleName='ProcessRollup2' AND ThreatFamily IN ('Emotet','TrickBot') AND Severity>=8"
Severity=CRITICAL
Description=Detects execution of known malware families used in initial access

[IA-003: SentinelOne Malware Detection]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='SentinelOne' AND event.type='Malware Detection' AND indicator.category='Malware' AND indicator.name IN ('Emotet','TrickBot','Cobalt Strike')"
Severity=CRITICAL
Description=Detects malware execution via SentinelOne endpoint protection

[IA-004: Suspicious Authentication After Email Event]
Detection logic conditions
Rule type=Correlation
Query="dataSource.vendor='Microsoft' AND resultType='0' AND riskLevelAggregated='high' AND ipAddress IN ('185.220.101.42','94.102.61.13','phishing-bank-security.com','secure-financorp-update.net')"
Correlation_Window=30 minutes
Severity=HIGH
Description=Detects successful authentication from suspicious IPs following phishing attempts

# PERSISTENCE PHASE DETECTIONS  
# =============================

[P-001: Registry Persistence Mechanism - CrowdStrike]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='CrowdStrike' AND event_simpleName='RegistryOperationDetectInfo' AND category='persistence'"
Severity=HIGH
Description=Detects registry modifications used for persistence mechanisms

[P-002: SentinelOne Registry Persistence]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='SentinelOne' AND event.type='Registry Modification' AND registry.keyPath CONTAINS 'CurrentVersion\\Run'"
Severity=HIGH
Description=Detects registry run key modifications for persistence via SentinelOne

[P-003: Lateral Movement Detection]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='Darktrace' AND model.name CONTAINS 'Rare External from Server' AND externalIP IN ('185.220.101.42','94.102.61.13')"
Severity=HIGH
Description=Detects lateral movement via unusual server outbound connections

[P-004: Account Management Changes]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='SentinelOne' AND event.category='Account Management' AND winEventLog.id=4728 AND winEventLog.description CONTAINS 'security-enabled global group'"
Severity=HIGH
Description=Detects suspicious group membership changes indicating persistence

[P-005: Process Injection Detection]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='SentinelOne' AND src.process.indicatorInjectionCount>0 AND src.process.crossProcessCount>5"
Severity=HIGH
Description=Detects process injection techniques used for persistence and evasion

# ESCALATION PHASE DETECTIONS
# ============================

[E-001: Credential Dumping Tools - CrowdStrike]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='CrowdStrike' AND event_simpleName='CredentialDumpTool' AND Severity=10"
Severity=CRITICAL
Description=Detects use of credential dumping tools like Mimikatz

[E-002: SentinelOne Credential Access]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='SentinelOne' AND event.type='Credential Access' AND src.process.name='mimikatz.exe' AND indicator.category='Credential Theft'"
Severity=CRITICAL
Description=Detects credential theft attempts via SentinelOne behavioral analysis

[E-003: Privileged Account Checkout]
Detection logic conditions
Rule type=Single event
Query="(dataSource.vendor='CyberArk' OR dataSource.vendor='BeyondTrust') AND EventType='AccountCheckout' AND AccountName='administrator' AND Severity='Critical'"
Severity=CRITICAL
Description=Detects checkout of high-privilege accounts during escalation phase

[E-004: Privilege Escalation Events]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='SentinelOne' AND event.type='Privilege Escalation' AND winEventLog.id=4672 AND indicator.category='Privilege Escalation'"
Severity=HIGH
Description=Detects privilege escalation via SentinelOne identity monitoring

[E-005: Secrets Access Detection]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='HashiCorp' AND request.operation='read' AND request.path CONTAINS 'database-credentials'"
Severity=HIGH
Description=Detects unauthorized access to sensitive secrets and credentials

# EXFILTRATION PHASE DETECTIONS
# ==============================

[EX-001: Large File Access Pattern]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='SentinelOne' AND event.type='File Access' AND tgt.file.path CONTAINS 'Financial_Data' AND tgt.file.size>10485760"
Severity=CRITICAL
Description=Detects access to large financial data files indicating potential exfiltration

[EX-002: Suspicious Outbound Traffic]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='Darktrace' AND title CONTAINS 'Data Exfiltration' AND dataTransfer.bytesTransferred>100000000"
Severity=CRITICAL
Description=Detects large volume data transfers indicating exfiltration activity

[EX-003: Cloud Data Exfiltration]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='Netskope' AND event_type='download' AND breach_score>90 AND file_size>50000000"
Severity=CRITICAL
Description=Detects high-risk cloud data downloads with large file sizes

[EX-004: Mass Data Access by Single User]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='Microsoft' AND category='DataExfiltration' AND activityGroupName CONTAINS 'Mass download' AND severity='critical'"
Severity=CRITICAL
Description=Detects mass data access patterns in Microsoft 365 indicating exfiltration

[EX-005: Network Exfiltration Behavior]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='SentinelOne' AND src.process.netConnOutCount>10 AND event.category='File' AND tgt.file.size>1048576"
Severity=HIGH
Description=Detects suspicious network activity combined with file access patterns

# CROSS-PLATFORM CORRELATION RULES
# ==================================

[CORR-001: Campaign-wide Attack Detection]
Detection logic conditions
Rule type=Aggregated event
Query="campaign_id EXISTS"
Threshold=count > 10 in 1 hour by campaign_id
Severity=CRITICAL
Description=Detects coordinated attack campaigns across multiple platforms and timeframes

[CORR-002: Kill Chain Progression Monitoring]
Detection logic conditions
Rule type=Correlation
Query="phase IN ('reconnaissance','initial_access','persistence','escalation','exfiltration')"
Correlation_Window=24 hours
Threshold=unique_count(phase) >= 3 by campaign_id
Severity=HIGH
Description=Detects progression through multiple attack phases indicating advanced persistent threat

[CORR-003: User Timeline Correlation]
Detection logic conditions
Rule type=Correlation
Query="(src.process.user IN ('john.doe','jane.smith','admin') OR event.login.userName IN ('john.doe','jane.smith','admin')) AND (dataSource.vendor='SentinelOne' OR dataSource.vendor='Microsoft')"
Correlation_Window=4 hours
Threshold=count > 5 by user
Severity=MEDIUM
Description=Detects unusual activity patterns for specific users across identity and endpoint platforms

[CORR-004: Infrastructure IOC Correlation]
Detection logic conditions
Rule type=Correlation
Query="(src.ip.address IN ('185.220.101.42','94.102.61.13') OR dst.ip.address IN ('185.220.101.42','94.102.61.13')) AND dataSource.vendor IN ('Darktrace','SentinelOne','CrowdStrike')"
Correlation_Window=2 hours
Severity=HIGH
Description=Detects connections to known attack infrastructure across multiple security platforms

[CORR-005: Multi-Platform Malware Campaign]
Detection logic conditions
Rule type=Correlation
Query="(dataSource.vendor='SentinelOne' AND indicator.category='Malware') OR (dataSource.vendor='CrowdStrike' AND ThreatFamily EXISTS) OR (dataSource.vendor='Microsoft' AND ThreatTypes='Malware')"
Correlation_Window=6 hours
Threshold=count > 3 AND unique_count(dataSource.vendor) >= 2
Severity=CRITICAL
Description=Detects malware activity detected by multiple security platforms indicating widespread campaign

# BEHAVIORAL ANALYTICS RULES
# ===========================

[BA-001: Anomalous Login Patterns]
Detection logic conditions
Rule type=Aggregated event
Query="dataSource.vendor='SentinelOne' AND event.category='Behavioral Analytics' AND indicator.category='Anomalous Behavior'"
Threshold=count > 3 in 2 hours by event.login.userName
Severity=MEDIUM
Description=Detects unusual login patterns that deviate from normal user behavior

[BA-002: Process Execution Anomalies]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='SentinelOne' AND (src.process.indicatorEvasionCount>2 OR src.process.indicatorPostExploitationCount>0)"
Severity=HIGH
Description=Detects processes with high evasion or post-exploitation indicators

[BA-003: Network Connection Anomalies]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='SentinelOne' AND event.category='Network' AND src.process.netConnOutCount>20"
Severity=MEDIUM
Description=Detects processes making unusually high numbers of outbound connections

# THREAT INTELLIGENCE ENRICHMENT
# ===============================

[TI-001: Known Bad IP Connections]
Detection logic conditions
Rule type=Single event
Query="tiIndicator.source='SentinelOne Threat Intelligence' AND tiIndicator.value IN ('185.220.101.42','94.102.61.13')"
Severity=HIGH
Description=Detects connections to IP addresses flagged by threat intelligence

[TI-002: Malware Family Detection]
Detection logic conditions
Rule type=Single event
Query="dataSource.vendor='SentinelOne' AND indicator.name IN ('Emotet','Cobalt Strike','Mimikatz','PowerShell Empire','WannaCry','TrickBot')"
Severity=CRITICAL
Description=Detects known malware families and tools used by threat actors

# INCIDENT RESPONSE TRIGGERS
# ===========================

[IR-001: Critical Attack Phase Reached]
Detection logic conditions
Rule type=Single event
Query="phase IN ('escalation','exfiltration') AND (dataSource.vendor='SentinelOne' OR dataSource.vendor='CrowdStrike' OR dataSource.vendor='CyberArk')"
Severity=CRITICAL
Auto_Response=true
Description=Triggers immediate incident response for critical attack phases

[IR-002: Multiple High-Severity Alerts]
Detection logic conditions
Rule type=Aggregated event
Query="Severity IN ('HIGH','CRITICAL')"
Threshold=count > 5 in 15 minutes
Severity=CRITICAL
Auto_Response=true
Description=Triggers escalation when multiple high-severity alerts occur in short timeframe

# CONFIGURATION NOTES
# ===================
# 
# Time Windows:
# - Correlation windows should be adjusted based on your environment
# - Consider business hours and legitimate user patterns
# 
# Thresholds:
# - Adjust count thresholds based on environment size and normal activity levels
# - Monitor for false positives and tune accordingly
# 
# Custom Fields:
# - Add custom fields specific to your SentinelOne deployment
# - Include relevant context fields for investigation
# 
# Auto-Response:
# - Configure automated response actions for critical detections
# - Include containment, notification, and evidence collection actions
# 
# Maintenance:
# - Regularly review and update IOCs and threat intelligence indicators
# - Update detection logic based on new attack techniques and tools
# - Validate detection effectiveness against known attack scenarios