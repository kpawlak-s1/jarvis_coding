{
  "attributes": {
    "dataSource.vendor": "AWS",
    "dataSource.name": "AWS Web Application Firewall", 
    "dataSource.category": "web_security",
    "dataSource.technology": "web_application_firewall",
    "source": "aws_waf"
  },
  
  "patterns": {},
  
  "formats": [
    {
      "id": "aws_waf_json",
      "format": ".*${parse=json}$",
      "attributes": {
        "dataSource.app": "AWS Web Application Firewall",
        "class_uid": 4002,
        "class_name": "HTTP Activity", 
        "category_uid": 4,
        "category_name": "Network Activity",
        "type_uid": 400201,
        "activity_id": 1,
        "activity_name": "HTTP Request",
        "severity_id": 3,
        "metadata.product.name": "AWS WAF",
        "metadata.product.vendor_name": "Amazon Web Services"
      },
      "rewrites": [
        {
          "input": "timestamp",
          "output": "time",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "httpRequest.clientIp",
          "output": "src_endpoint.ip",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "action",
          "output": "disposition",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "httpRequest.uri",
          "output": "http_request.url.text",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "httpRequest.country",
          "output": "src_endpoint.location.country",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "httpRequest.httpMethod",
          "output": "http_request.http_method",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "webaclId",
          "output": "firewall_rule.uid",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "ruleGroupId",
          "output": "firewall_rule.name",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "terminatingRuleType",
          "output": "firewall_rule.type",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "httpRequest.httpVersion",
          "output": "http_request.version",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "formatVersion",
          "output": "metadata.version",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "action",
          "output": "status_id",
          "match": "ALLOW",
          "replace": "1"
        },
        {
          "input": "action",
          "output": "status_id",
          "match": "BLOCK",
          "replace": "2"
        },
        {
          "input": "action",
          "output": "status_id",
          "match": "CAPTCHA|COUNT",
          "replace": "99"
        },
        {
          "input": "action",
          "output": "activity_id",
          "match": "ALLOW",
          "replace": "1"
        },
        {
          "input": "action",
          "output": "activity_id",
          "match": "BLOCK",
          "replace": "2"
        },
        {
          "input": "action",
          "output": "activity_id",
          "match": "CAPTCHA",
          "replace": "3"
        },
        {
          "input": "action",
          "output": "activity_id",
          "match": "COUNT",
          "replace": "4"
        },
        {
          "input": "action",
          "output": "severity_id",
          "match": "ALLOW",
          "replace": "1"
        },
        {
          "input": "action",
          "output": "severity_id",
          "match": "BLOCK",
          "replace": "4"
        },
        {
          "input": "action",
          "output": "severity_id",
          "match": "CAPTCHA",
          "replace": "3"
        },
        {
          "input": "action",
          "output": "severity_id",
          "match": "COUNT",
          "replace": "2"
        },
        {
          "input": "httpRequest.clientIp",
          "output": "observables",
          "match": ".*",
          "replace": "[{\"name\":\"client_ip\",\"type\":\"IP Address\",\"value\":\"$0\",\"type_id\":2},{\"name\":\"webacl_id\",\"type\":\"Other\",\"value\":\"${webaclId}\",\"type_id\":99},{\"name\":\"uri\",\"type\":\"URL\",\"value\":\"${httpRequest.uri}\",\"type_id\":23}]"
        },
        {
          "input": "httpRequest.args",
          "output": "http_request.url.query_string",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "requestId",
          "output": "http_request.uid",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "httpRequest.headers",
          "output": "http_request.http_headers",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "labels",
          "output": "metadata.labels",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "ruleGroupId",
          "output": "metadata.extension.rule_group_id",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "terminatingRuleType",
          "output": "metadata.extension.terminating_rule_type",
          "match": ".*",
          "replace": "$0"
        }
      ],
      "halt": true
    }
  ]
}