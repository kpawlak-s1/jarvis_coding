{
  "attributes": {
    "dataSource.vendor": "Akamai",
    "dataSource.name": "Akamai Security",
    "dataSource.category": "security",
    "dataSource.technology": "web_application_firewall",
    "source": "akamai_security"
  },
  
  "patterns": {
    "timestamp": "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z",
    "ip_address": "\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}",
    "http_method": "(GET|POST|PUT|DELETE|HEAD|OPTIONS|PATCH)",
    "attack_type": "(SQL_Injection|Cross_Site_Scripting|API_Scan|Command_Injection|Path_Traversal)",
    "action": "(blocked|alert|logged|denied)",
    "quoted_string": "\"[^\"]*\"",
    "field_value": "[^\\s]+"
  },
  
  "formats": [
    {
      "id": "akamai_security_event",
      "format": "$timestamp$ AkamaiSecurity clientIP=$quoted_string{name=client_ip}$ host=$quoted_string{name=host}$ path=$quoted_string{name=path}$ ruleId=$quoted_string{name=rule_id}$ attackType=$quoted_string{name=attack_type}$ action=$quoted_string{name=action}$ httpMethod=$quoted_string{name=http_method}$ status=$field_value{name=status_code}$ userAgent=$quoted_string{name=user_agent}$ message=$quoted_string{name=message}$",
      "attributes": {
        "dataSource.app": "Akamai Security Events",
        "class_uid": 2001,
        "class_name": "Security Control",
        "category_uid": 2,
        "category_name": "Findings",
        "type_uid": 200101,
        "activity_id": 1,
        "activity_name": "Security Alert",
        "severity_id": 2
      },
      "rewrites": [
        {
          "input": "timestamp",
          "output": "time",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "client_ip",
          "output": "src_endpoint.ip",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "host",
          "output": "http_request.hostname",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "path",
          "output": "http_request.url.path",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "http_method",
          "output": "http_request.http_method",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "status_code",
          "output": "http_response.code",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "user_agent",
          "output": "http_request.user_agent",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "rule_id",
          "output": "metadata.rule_uid",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "attack_type",
          "output": "finding.type",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "action",
          "output": "disposition",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "message",
          "output": "message",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "action",
          "output": "status_id",
          "match": "blocked|denied",
          "replace": "2"
        },
        {
          "input": "action",
          "output": "status_id",
          "match": "alert|logged",
          "replace": "1"
        },
        {
          "input": "attack_type",
          "output": "severity_id",
          "match": "SQL_Injection|Command_Injection",
          "replace": "4"
        },
        {
          "input": "attack_type",
          "output": "severity_id",
          "match": "Cross_Site_Scripting|Path_Traversal",
          "replace": "3"
        },
        {
          "input": "attack_type",
          "output": "severity_id",
          "match": "API_Scan",
          "replace": "2"
        },
        {
          "input": "client_ip",
          "output": "observables",
          "match": ".*",
          "replace": "[{\"name\":\"src_ip\",\"type\":\"IP Address\",\"value\":\"$0\"}]"
        }
      ],
      "halt": true
    }
  ]
}