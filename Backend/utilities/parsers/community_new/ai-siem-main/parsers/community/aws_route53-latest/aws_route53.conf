{
  "attributes": {
    "dataSource.vendor": "AWS",
    "dataSource.name": "AWS Route 53",
    "dataSource.category": "network",
    "dataSource.technology": "dns",
    "source": "aws_route53"
  },
  
  "patterns": {
    "timestamp": "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z",
    "ip_address": "\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}",
    "query_type": "(A|AAAA|MX|NS|PTR|SOA|TXT|CNAME|SRV)",
    "response_code": "(NOERROR|NXDOMAIN|SERVFAIL|REFUSED|TIMEOUT)",
    "domain": "[a-zA-Z0-9._-]+",
    "edge_location": "[A-Z]{3}\\d{2}-P\\d",
    "resolver_id": "rslvr-endpt-\\d+",
    "quoted_string": "\"[^\"]*\"",
    "field_value": "[^\\s,}]+"
  },
  
  "formats": [
    {
      "id": "aws_route53_query",
      "format": "$timestamp$ Route53 queryName=$quoted_string{name=query_name}$ queryType=$quoted_string{name=query_type}$ clientIp=$quoted_string{name=client_ip}$ edgeLocation=$quoted_string{name=edge_location}$ responseCode=$quoted_string{name=response_code}$ resolverEndpointId=$quoted_string{name=resolver_id}$",
      "attributes": {
        "dataSource.app": "AWS Route 53 DNS",
        "class_uid": 4003,
        "class_name": "DNS Activity",
        "category_uid": 4,
        "category_name": "Network Activity",
        "type_uid": 400306,
        "activity_id": 6,
        "activity_name": "Traffic",
        "severity_id": 1
      },
      "rewrites": [
        {
          "input": "timestamp",
          "output": "time",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "query_name",
          "output": "query.hostname",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "query_type",
          "output": "query.type",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "client_ip",
          "output": "src_endpoint.ip",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "edge_location",
          "output": "src_endpoint.location.desc",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "response_code",
          "output": "rcode",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "resolver_id",
          "output": "dst_endpoint.uid",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "response_code",
          "output": "status_id",
          "match": "NOERROR",
          "replace": "1"
        },
        {
          "input": "response_code",
          "output": "status_id",
          "match": "NXDOMAIN|SERVFAIL|REFUSED|TIMEOUT",
          "replace": "2"
        },
        {
          "input": "client_ip",
          "output": "observables",
          "match": ".*",
          "replace": "[{\"name\":\"client_ip\",\"type\":\"IP Address\",\"value\":\"$0\"},{\"name\":\"query_hostname\",\"type\":\"Hostname\",\"value\":\"${query_name}\"}]"
        }
      ],
      "halt": true
    }
  ]
}