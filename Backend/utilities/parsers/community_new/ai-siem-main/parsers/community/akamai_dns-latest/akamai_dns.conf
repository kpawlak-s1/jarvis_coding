{
  "attributes": {
    "dataSource.vendor": "Akamai",
    "dataSource.name": "Akamai DNS", 
    "dataSource.category": "network",
    "dataSource.technology": "dns",
    "source": "akamai_dns"
  },
  
  "patterns": {
    "timestamp": "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z",
    "ip_address": "\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}",
    "dns_response_code": "(NOERROR|NXDOMAIN|SERVFAIL|FORMERR|REFUSED)",
    "dns_record_type": "(A|AAAA|CNAME|MX|NS|PTR|SOA|TXT|SRV)",
    "quoted_string": "\"[^\"]*\"",
    "field_value": "[^\\s]+"
  },
  
  "formats": [
    {
      "id": "akamai_dns_query_log",
      "format": "$timestamp$ AkamaiDNS streamId=$quoted_string{name=stream_id}$ cliIP=$quoted_string{name=client_ip}$ resolverIP=$quoted_string{name=resolver_ip}$ domain=$quoted_string{name=domain}$ recordType=$quoted_string{name=record_type}$ responseCode=$quoted_string{name=response_code}$ answer=$quoted_string{name=answer}$ edge=$quoted_string{name=edge_server}$ ttl=$field_value{name=ttl}$ bytes=$field_value{name=bytes}$",
      "attributes": {
        "dataSource.app": "Akamai DNS Query Logs",
        "class_uid": 4003,
        "class_name": "DNS Activity",
        "category_uid": 4, 
        "category_name": "Network Activity",
        "type_uid": 400301,
        "activity_id": 1,
        "activity_name": "DNS Query",
        "severity_id": 1
      },
      "rewrites": [
        {
          "input": "timestamp",
          "output": "time",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "client_ip",
          "output": "src_endpoint.ip", 
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "resolver_ip",
          "output": "dst_endpoint.ip",
          "match": ".*", 
          "replace": "$0"
        },
        {
          "input": "domain",
          "output": "query.hostname",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "record_type", 
          "output": "query.type",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "response_code",
          "output": "response.code",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "answer",
          "output": "answers.address",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "ttl",
          "output": "answers.ttl", 
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "bytes",
          "output": "response.length",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "edge_server",
          "output": "metadata.log_name",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "stream_id",
          "output": "metadata.correlation_uid", 
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "response_code",
          "output": "status_id",
          "match": "NOERROR",
          "replace": "1"
        },
        {
          "input": "response_code",
          "output": "status_id",
          "match": "(NXDOMAIN|SERVFAIL|FORMERR|REFUSED)",
          "replace": "2"
        },
        {
          "input": "response_code",
          "output": "severity_id",
          "match": "NOERROR", 
          "replace": "1"
        },
        {
          "input": "response_code",
          "output": "severity_id",
          "match": "(NXDOMAIN|SERVFAIL|FORMERR|REFUSED)",
          "replace": "2"
        },
        {
          "input": "domain",
          "output": "observables",
          "match": ".*",
          "replace": "[{\"name\":\"query_hostname\",\"type\":\"Hostname\",\"value\":\"$0\"}]"
        }
      ],
      "halt": true
    }
  ]
}