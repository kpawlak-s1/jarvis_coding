{
  "attributes": {
    "dataSource.vendor": "Cisco",
    "dataSource.name": "Cisco ISA3000",
    "dataSource.category": "security",
    "dataSource.technology": "industrial_security_appliance",
    "source": "cisco_isa3000"
  },
  
  "patterns": {
    "timestamp": "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3,6})?([+-]\\d{2}:\\d{2}|Z)?",
    "ip_address": "\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}",
    "hostname": "[a-zA-Z0-9._-]+",
    "port_number": "\\d{1,5}",
    "event_type": "(FIREWALL|IPS|VPN|SYSTEM|MODBUS|SCADA)",
    "action": "(ALLOW|DENY|ALERT|DROP|CONNECT|DISCONNECT|BOOT|CONFIG_CHANGE|READ_COILS|WRITE_REGISTERS|HMI_ACCESS|UNAUTHORIZED_COMMAND)",
    "severity": "(INFO|WARNING|HIGH|CRITICAL|NOTICE)",
    "protocol": "(TCP|UDP)",
    "zone": "(TRUSTED|UNTRUSTED|DMZ|SCADA|CORPORATE)",
    "modbus_function": "\\d{1,2}",
    "field_value": "[^\\s,}]+",
    "quoted_string": "\"[^\"]*\""
  },
  
  "formats": [
    {
      "id": "cisco_isa3000_firewall_event", 
      "format": "\\{\"timestamp\":\"$timestamp$\",\"hostname\":\"$hostname$\",\"device_ip\":\"$ip_address{name=device_ip}$\",\"event_type\":\"FIREWALL\",\"action\":\"$action$\",\"severity\":\"$severity$\",\"message_id\":\"$field_value{name=message_id}$\",\"source_ip\":\"$ip_address{name=source_ip}$\",\"destination_ip\":\"$ip_address{name=destination_ip}$\",\"source_port\":$port_number{name=source_port}$,\"destination_port\":$port_number{name=destination_port}$,\"protocol\":\"$protocol$\",\"zone_from\":\"$zone{name=zone_from}$\",\"zone_to\":\"$zone{name=zone_to}$\".*",
      "attributes": {
        "class_uid": 2001,
        "class_name": "Security Control",
        "category_uid": 2,
        "category_name": "Findings",
        "type_uid": 200101,
        "activity_id": 1,
        "activity_name": "Security Alert"
      },
      "rewrites": [
        {
          "input": "timestamp",
          "output": "time",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "hostname",
          "output": "device.hostname",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "device_ip",
          "output": "device.ip",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "source_ip",
          "output": "src_endpoint.ip",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "destination_ip",
          "output": "dst_endpoint.ip",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "source_port",
          "output": "src_endpoint.port",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "destination_port",
          "output": "dst_endpoint.port",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "protocol",
          "output": "connection_info.protocol_name",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "action",
          "output": "disposition",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "action",
          "output": "status_id",
          "match": "DENY|DROP",
          "replace": "2"
        },
        {
          "input": "action",
          "output": "status_id",
          "match": "ALLOW",
          "replace": "1"
        },
        {
          "input": "action",
          "output": "status_id",
          "match": "ALERT",
          "replace": "99"
        },
        {
          "input": "severity",
          "output": "severity_id",
          "match": "CRITICAL",
          "replace": "5"
        },
        {
          "input": "severity",
          "output": "severity_id",
          "match": "HIGH",
          "replace": "4"
        },
        {
          "input": "severity",
          "output": "severity_id",
          "match": "WARNING",
          "replace": "3"
        },
        {
          "input": "severity",
          "output": "severity_id",
          "match": "NOTICE",
          "replace": "2"
        },
        {
          "input": "severity",
          "output": "severity_id",
          "match": "INFO",
          "replace": "1"
        },
        {
          "input": "zone_from",
          "output": "src_endpoint.zone_uid",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "zone_to",
          "output": "dst_endpoint.zone_uid",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "message_id",
          "output": "metadata.uid",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "source_ip",
          "output": "observables",
          "match": ".*",
          "replace": "[{\"name\":\"src_ip\",\"type\":\"IP Address\",\"value\":\"$0\"},{\"name\":\"dst_ip\",\"type\":\"IP Address\",\"value\":\"${destination_ip}\"}]"
        }
      ],
      "halt": true
    },
    {
      "id": "cisco_isa3000_modbus_event",
      "format": "\\{\"timestamp\":\"$timestamp$\",\"hostname\":\"$hostname$\",\"event_type\":\"MODBUS\",\"action\":\"$action$\",.*\"modbus_function_code\":$modbus_function{name=modbus_function_code}$,\"modbus_function_name\":\"$field_value{name=modbus_function_name}$\",\"modbus_unit_id\":$field_value{name=modbus_unit_id}$,\"register_address\":$field_value{name=register_address}$.*",
      "attributes": {
        "class_uid": 4001,
        "class_name": "Network Activity",
        "category_uid": 4,
        "category_name": "Network Activity",
        "type_uid": 400199,
        "activity_id": 99,
        "activity_name": "Industrial Protocol Activity"
      },
      "rewrites": [
        {
          "input": "timestamp",
          "output": "time",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "hostname",
          "output": "device.hostname",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "modbus_function_code",
          "output": "metadata.product.feature.uid",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "modbus_function_name",
          "output": "type_name",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "modbus_unit_id",
          "output": "device.uid",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "register_address",
          "output": "metadata.correlation_uid",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "action",
          "output": "activity_name",
          "match": ".*",
          "replace": "$0"
        }
      ],
      "halt": true
    }
  ]
}