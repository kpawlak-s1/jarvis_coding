{
  "attributes": {
    "dataSource.vendor": "Google",
    "dataSource.name": "Google Workspace",
    "dataSource.category": "security",
    "dataSource.technology": "collaboration",
    "source": "google_workspace"
  },
  
  "patterns": {
    "timestamp": "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?[+-]\\d{2}:\\d{2}",
    "ip_address": "\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}",
    "email_address": "[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}",
    "uuid": "[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}",
    "field_value": "[^\\s,]+",
    "quoted_string": "\"[^\"]*\""
  },
  
  "formats": [
    {
      "id": "google_workspace_activity",
      "format": "$timestamp$ GoogleWorkspace kind=$quoted_string{name=kind}$ applicationName=$quoted_string{name=application_name}$ actorEmail=$email_address{name=actor_email}$ ipAddress=$ip_address{name=ip_address}$ eventType=$quoted_string{name=event_type}$ eventName=$quoted_string{name=event_name}$ ownerDomain=$quoted_string{name=owner_domain}$ customerId=$quoted_string{name=customer_id}$",
      "attributes": {
        "dataSource.app": "Google Workspace Activity",
        "class_uid": 8001,
        "class_name": "DevOps Activity",
        "category_uid": 8,
        "category_name": "Identity & Access Management",
        "type_uid": 800101,
        "activity_id": 1,
        "activity_name": "Create",
        "severity_id": 2
      },
      "rewrites": [
        {
          "input": "timestamp",
          "output": "time",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "actor_email",
          "output": "actor.user.email_addr",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "actor_email",
          "output": "user.email_addr",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "ip_address",
          "output": "src_endpoint.ip",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "application_name",
          "output": "metadata.product.name",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "event_type",
          "output": "type_name",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "event_name",
          "output": "activity_name",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "owner_domain",
          "output": "metadata.tenant_uid",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "customer_id",
          "output": "metadata.correlation_uid",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "event_name",
          "output": "activity_id",
          "match": "(?i)(create|upload|grant|add|assign)",
          "replace": "1"
        },
        {
          "input": "event_name",
          "output": "activity_id",
          "match": "(?i)(view|access|login_success)",
          "replace": "2"
        },
        {
          "input": "event_name",
          "output": "activity_id",
          "match": "(?i)(edit|change|update)",
          "replace": "3"
        },
        {
          "input": "event_name",
          "output": "activity_id",
          "match": "(?i)(delete|revoke|remove)",
          "replace": "4"
        },
        {
          "input": "event_name",
          "output": "activity_id",
          "match": "(?i)(share|download)",
          "replace": "5"
        },
        {
          "input": "event_name",
          "output": "status_id",
          "match": "(?i)(success|create|upload|grant|view)",
          "replace": "1"
        },
        {
          "input": "event_name",
          "output": "status_id",
          "match": "(?i)(failure|delete|suspicious|phishing|leak)",
          "replace": "2"
        },
        {
          "input": "event_name",
          "output": "severity_id",
          "match": "(?i)(suspicious|phishing|leak|disabled)",
          "replace": "4"
        },
        {
          "input": "event_name",
          "output": "severity_id",
          "match": "(?i)(failure|challenge|delete|revoke)",
          "replace": "3"
        },
        {
          "input": "event_name",
          "output": "severity_id",
          "match": "(?i)(success|create|view|login|logout)",
          "replace": "1"
        },
        {
          "input": "actor_email",
          "output": "observables",
          "match": ".*",
          "replace": "[{\"name\":\"actor_email\",\"type\":\"Email Address\",\"value\":\"$0\"},{\"name\":\"source_ip\",\"type\":\"IP Address\",\"value\":\"${ip_address}\"},{\"name\":\"application\",\"type\":\"Application\",\"value\":\"${application_name}\"}]"
        }
      ],
      "halt": true
    }
  ]
}