{
  "attributes": {
    "dataSource.category": "security",
    "dataSource.name": "Akamai SiteDefender",
    "dataSource.vendor": "Akamai"
  },
  "formats": [
    {
      "id": "akamai_sitedefender_json",
      "format": ".*${parse=json}$",
      "attributes": {
        "dataSource.app": "Akamai SiteDefender WAF",
        "class_uid": 2001,
        "class_name": "Security Control",
        "category_uid": 2,
        "category_name": "Findings",
        "type_uid": 200101,
        "activity_id": 1,
        "activity_name": "Security Finding",
        "severity_id": 3
      },
      "rewrites": [
        {
          "input": "type",
          "output": "metadata.product.name",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "time",
          "output": "time",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "attackData.clientIP",
          "output": "src_endpoint.ip",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "attackData.configId",
          "output": "metadata.correlation_uid",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "attackData.policyId",
          "output": "policy.name",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "attackData.rules[].rule",
          "output": "observables",
          "match": ".*",
          "replace": "Rule: $0"
        },
        {
          "input": "attackData.rules[].ruleAction",
          "output": "disposition",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "attackData.rules[].ruleMessage",
          "output": "message",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "httpMessage.method",
          "output": "http_request.http_method",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "httpMessage.host",
          "output": "http_request.url.hostname",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "httpMessage.path",
          "output": "http_request.url.path",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "httpMessage.status",
          "output": "http_response.code",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "geo.city",
          "output": "src_endpoint.location.city",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "geo.country",
          "output": "src_endpoint.location.country",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "userRiskData.botScore",
          "output": "risk_score",
          "match": ".*",
          "replace": "$0"
        }
      ]
    }
  ],
  "mappings": {
    "version": 1,
    "mappings": [
      {
        "predicate": "attackData.rules[].ruleAction = *",
        "transformations": [
          {
            "constant": {
              "value": "4002",
              "field": "class_uid"
            }
          },
          {
            "constant": {
              "value": "HTTP Activity",
              "field": "class_name"
            }
          },
          {
            "constant": {
              "value": "1",
              "field": "activity_id",
              "predicate": "attackData.rules[].ruleAction = 'ALERT'"
            }
          },
          {
            "constant": {
              "value": "2",
              "field": "activity_id",
              "predicate": "attackData.rules[].ruleAction = 'BLOCK'"
            }
          },
          {
            "constant": {
              "value": "99",
              "field": "activity_id",
              "predicate": "attackData.rules = []"
            }
          },
          {
            "constant": {
              "value": "Other",
              "field": "activity_name",
              "predicate": "activity_id = '99'"
            }
          },
          {
            "constant": {
              "value": "Access Granted",
              "field": "activity_name",
              "predicate": "activity_id = '1'"
            }
          },
          {
            "constant": {
              "value": "Access Denied",
              "field": "activity_name",
              "predicate": "activity_id = '2'"
            }
          },
          {
            "constant": {
              "value": "3",
              "field": "severity_id",
              "predicate": "attackData.rules[].ruleAction = 'BLOCK'"
            }
          },
          {
            "constant": {
              "value": "2",
              "field": "severity_id",
              "predicate": "attackData.rules[].ruleAction = 'ALERT'"
            }
          },
          {
            "constant": {
              "value": "1",
              "field": "severity_id",
              "predicate": "attackData.rules = []"
            }
          },
          {
            "constant": {
              "value": "High",
              "field": "severity",
              "predicate": "severity_id = '3'"
            }
          },
          {
            "constant": {
              "value": "Medium",
              "field": "severity",
              "predicate": "severity_id = '2'"
            }
          },
          {
            "constant": {
              "value": "Low",
              "field": "severity",
              "predicate": "severity_id = '1'"
            }
          }
        ]
      }
    ]
  }
}