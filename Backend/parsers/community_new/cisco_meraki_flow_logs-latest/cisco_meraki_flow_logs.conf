{
  "attributes": {
    "dataSource.vendor": "Cisco",
    "dataSource.name": "Cisco Meraki",
    "dataSource.category": "network",
    "dataSource.technology": "firewall",
    "source": "cisco_meraki"
  },
  
  "patterns": {
    "syslog_priority": "<\\d{1,3}>",
    "unix_timestamp": "\\d{10}",
    "hostname": "[a-zA-Z0-9._-]+",
    "ip_address": "\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}",
    "port_number": "\\d{1,5}",
    "protocol": "(tcp|udp|icmp)",
    "connection_status": "(start|allowed|tear)",
    "mac_address": "[a-fA-F0-9]{2}:[a-fA-F0-9]{2}:[a-fA-F0-9]{2}:[a-fA-F0-9]{2}:[a-fA-F0-9]{2}:[a-fA-F0-9]{2}",
    "pattern_action": "(allowed|blocked)\\s+\\d+",
    "field_value": "[^\\s,}]+"
  },
  
  "formats": [
    {
      "id": "meraki_vpn_firewall",
      "format": "$syslog_priority{name=priority}$ $unix_timestamp{name=timestamp}$ $hostname{name=device_hostname}$ vpn_firewall src=$ip_address{name=src_ip}$ dst=$ip_address{name=dst_ip}$ protocol=$protocol$ sport=$port_number{name=src_port}$ dport=$port_number{name=dst_port}$ pattern: $pattern_action{name=pattern}$",
      "attributes": {
        "class_uid": 4001,
        "class_name": "Network Activity", 
        "category_uid": 4,
        "category_name": "Network Activity",
        "type_uid": 400101,
        "activity_id": 1,
        "activity_name": "Traffic"
      },
      "rewrites": [
        {
          "input": "timestamp",
          "output": "time",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "device_hostname",
          "output": "device.hostname",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "src_ip",
          "output": "src_endpoint.ip",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "dst_ip",
          "output": "dst_endpoint.ip",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "src_port",
          "output": "src_endpoint.port",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "dst_port",
          "output": "dst_endpoint.port",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "protocol",
          "output": "connection_info.protocol_name",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "pattern",
          "output": "disposition",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "pattern",
          "output": "status_id",
          "match": "allowed",
          "replace": "1"
        },
        {
          "input": "pattern",
          "output": "status_id",
          "match": "blocked",
          "replace": "2"
        },
        {
          "input": "src_ip",
          "output": "observables",
          "match": ".*",
          "replace": "[{\"name\":\"src_ip\",\"type\":\"IP Address\",\"value\":\"$0\"},{\"name\":\"dst_ip\",\"type\":\"IP Address\",\"value\":\"${dst_ip}\"}]"
        }
      ],
      "halt": true
    },
    {
      "id": "meraki_ip_flow",
      "format": "$syslog_priority{name=priority}$ $unix_timestamp{name=timestamp}$ $hostname{name=device_hostname}$ ip_flow src=$ip_address{name=src_ip}$ dst=$ip_address{name=dst_ip}$ protocol=$protocol$ sport=$port_number{name=src_port}$ dport=$port_number{name=dst_port}$ translated_src_ip=$ip_address{name=translated_src_ip}$ translated_port=$port_number{name=translated_port}$",
      "attributes": {
        "class_uid": 4001,
        "class_name": "Network Activity",
        "category_uid": 4,
        "category_name": "Network Activity",
        "type_uid": 400101,
        "activity_id": 1,
        "activity_name": "Traffic"
      },
      "rewrites": [
        {
          "input": "timestamp", 
          "output": "time",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "device_hostname",
          "output": "device.hostname",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "src_ip",
          "output": "src_endpoint.ip",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "dst_ip",
          "output": "dst_endpoint.ip",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "src_port",
          "output": "src_endpoint.port",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "dst_port",
          "output": "dst_endpoint.port",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "protocol",
          "output": "connection_info.protocol_name",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "translated_src_ip",
          "output": "dst_endpoint.intermediate_ips",
          "match": ".*",
          "replace": "[\"$0\"]"
        },
        {
          "input": "translated_port",
          "output": "metadata.correlation_uid",
          "match": ".*",
          "replace": "$0"
        }
      ],
      "halt": true
    },
    {
      "id": "meraki_flows",
      "format": "$syslog_priority{name=priority}$ $unix_timestamp{name=timestamp}$ $hostname{name=device_hostname}$ flows $connection_status$ src=$ip_address{name=src_ip}$ dst=$ip_address{name=dst_ip}$ mac=$mac_address{name=src_mac}$ protocol=$protocol$ sport=$port_number{name=src_port}$ dport=$port_number{name=dst_port}$",
      "attributes": {
        "class_uid": 4001,
        "class_name": "Network Activity",
        "category_uid": 4,
        "category_name": "Network Activity",
        "type_uid": 400101,
        "activity_id": 1,
        "activity_name": "Traffic"
      },
      "rewrites": [
        {
          "input": "timestamp",
          "output": "time",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "device_hostname",
          "output": "device.hostname",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "src_ip",
          "output": "src_endpoint.ip",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "dst_ip",
          "output": "dst_endpoint.ip",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "src_port",
          "output": "src_endpoint.port",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "dst_port",
          "output": "dst_endpoint.port",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "src_mac",
          "output": "src_endpoint.mac",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "protocol",
          "output": "connection_info.protocol_name",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "connection_status",
          "output": "connection_info.boundary",
          "match": ".*",
          "replace": "$0"
        },
        {
          "input": "connection_status",
          "output": "status_id",
          "match": "start|allowed",
          "replace": "1"
        },
        {
          "input": "connection_status",
          "output": "status_id",
          "match": "tear",
          "replace": "2"
        }
      ],
      "halt": true
    }
  ]
}